<html>
<head>
  <link rel="stylesheet" href="./dist/talkie.min.css">
  <link rel="stylesheet" href="./dist/talkie-default.min.css">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/monokai_sublime.min.css">
</head>
<body>

<script layout type="text/x-markdown">
## 5章
### HTTP/1.1のセマンティクス:
### 広がるHTTPの用途
</script>

<script layout type="text/x-markdown">
* HTTP/1.1以降で拡張されたプロトコルや規約を使った事例を紹介
*  ▶ ファイルのダウンロード (ファイル名指定)
*  ▶ ダウンロードの中断・再開 (範囲アクセス)
*  ▶ XMLHttpRequest
*  ▶ Geo-Location
*  ▶ X-Powered-By
*  ▶ リモートプロシージャコール
*  ▶ WebDAV
*  ▶ Webサイト間で共通の認証・認可プラットフォーム
</script>

<script layout type="text/x-markdown">
### 5.1 ファイルをダウンロードした後でローカルに保存
</script>

<script layout type="text/x-markdown">
* `Content-Disposition: attachment; filename=ファイル名`のようなヘッダーがあると、ファイル保存ダイアログが表示される
* ・ ファイル名のデフォルトを日本語にする場合は、`*=utf-8'' 日本語ファイル名`を加える
* `Content-Disposition`ヘッダーも電子メールのRFCから移植された
* ダウンロード完了ページは、`<meta http-equiv="refresh" content="o;URL=./download_file">` を使って実現している
</script>

<script layout type="text/x-markdown">
### 5.2 ダウンロードの中断、再開
</script>

<script layout type="text/x-markdown">
* 通信回線が不安定な場合などのために、ダウンロードを中断・再開できる機能が用意されている
* サーバーが範囲指定ダウンロードに対応している場合は、`Accept-Ranges`ヘッダーを返す
* ・ `Accept-Ranges: bytes`: 範囲指定ダウンロードを、バイト単位で受け入れる
* ・ `Accept-Ranges: none`: 範囲指定ダウンロードを受け入れない
* また、ダウンロードしたいファイルのEtagヘッダーを受け取って、変更を検知する必要がある
  * ・ダウンロードの途中でファイル内容が変更されてしまうと、ダウンロードしたファイル片の価値がなくなるため
</script>

<script layout type="text/x-markdown">
* リクエストを送る時は、欲しい範囲を`Range`ヘッダーに付与する
* レスポンスのステータスコードは、以下の2種類がある
* ・ダウンロードできる場合は、 `206 Partial Content`
* ・クライアントからの範囲指定が無効の場合は、`416 Range Not Satisfiable`
</script>

<script layout type="text/x-markdown">
### 5.2.1 複数範囲のダウンロード
</script>

<script layout type="text/x-markdown">
* `Ranges`ヘッダーを使って、複数範囲指定が可能
* レスポンスには、`Content-Type: multipart/byterangtes`が返ってくる
</script>

<script layout type="text/x-markdown">
### 5.2.2 並列ダウンロード
</script>

<script layout type="text/x-markdown">
* Rangeヘッダーを用いたHTTPアクセスを複数行うことで、ダウンロード速度をあげる手法
* ただし、サーバーに負荷がかかるため、あまり推奨されていない
</script>

<script layout type="text/x-markdown">
### 5.3 XMLHttpRequest
</script>

<script layout type="text/x-markdown">
* XMLHttpRequest(XHR)は、curl相当の機能をJSから実現するもの
* ・ `open()`メソッドで、送信先を指定する。非同期処理をするため、第3引数は基本的にtrueにする
* ・ `send()`メソッドで、送信を開始する
* ・ `onload`イベントで、レスポンスが返ってきた後の処理を指定する
</script>

<script layout="code" invert type="text/x-markdown">
* GETする場合 (`curl -H "MyHeader=HeaderValue" /json`に相当)

```js
const xhr = new XMLHttpRequest();
xhr.open('GET', '/json', true);
xhr.onload = () => {
  // レスポンスが返ってきた時に呼ばれるメソッド
  if (xhr.status === 200) {
    // JSON parseして表示
    console.log(JSON.parse(xhr.responseText));
  }
};
xhr.setRequestHeader('MyHeader', 'HeaderValue');
xhr.send();
```
</script>

<script layout="code" invert type="text/x-markdown">
* POSTする場合 (`curl -d '{"message": "hello world"}' /json`に相当)

```js
const xhr = new XMLHttpRequest();
xhr.open('POST', '/json', true);
xhr.onload = () => {
  // レスポンスが返ってきた時に呼ばれるメソッド
};
xhr.send(JSON.stringify({"message": "hello world"}));
```
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>

<script layout type="text/x-markdown">
### 5.
</script>

<script layout type="text/x-markdown">
*
</script>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script src="./dist/talkie.min.js"></script>
<script>Talkie();</script>
</body>
</html>
