<html>
<head>
  <link rel="stylesheet" href="./dist/talkie.min.css">
  <link rel="stylesheet" href="./dist/talkie-default.min.css">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/monokai_sublime.min.css">
</head>
<body>

<script layout type="text/x-markdown">
## 2章
### HTTP/1.0のセマンティクス:
### ブラウザの基本機能の裏側
</script>

<script layout type="text/x-markdown">
* 基本の4要素を使って、<br>ブラウザの基本機能をどのように実現しているかを見ていく
</script>

<script layout type="text/x-markdown">
### 2.1 シンプルなフォームの送信
### (x-www-form-urlencoded)
</script>

<script layout type="text/x-markdown">
### ボディの受信
* HTTP/1.0では、<br>クライアントが指定したコンテンツがそのまま格納されるだけ
* フォームを使ったPOST送信には2種類ある
* -> この節では、シンプルな方式を見る<br>(x-www-form-urlencoded)
</script>

<script layout="code" invert type="text/x-markdown">
### -dで送信した場合

```sh
curl --http1.0 -d title="The Art of Community" -d author="Jono Bacon" http://localhost:18888
```

```http
POST / HTTP/1.0
Host: localhost:18888
Connection: close
Accept: */*
Content-Length: 44
Content-Type: application/x-www-form-urlencoded
User-Agent: curl/7.43.0

title=The Art of Community&author=Jono Bacon
```

</script>

<script layout="code" invert type="text/x-markdown">
### --data-urlencodeで送信した場合

```sh
curl --http1.0 --data-urlencode title="Head First PHP & MySQL" --data-urlencode author="Lynn Beighley, Michael Morrison" http://localhost:18888
```

```http
POST / HTTP/1.0
Host: localhost:18888
Connection: close
Accept: */*
Content-Length: 85
Content-Type: application/x-www-form-urlencoded
User-Agent: curl/7.43.0

title=Head%20First%20PHP%20%26%20MySQL&author=Lynn%20Beighley%2C%20Michael%20Morrison
```

</script>

<script layout type="text/x-markdown">
### 2.2 フォームを使ったファイルの送信
### (multipart/form-data)
</script>

<script layout type="text/x-markdown">
### multipart/form-data
* 1度のリクエストで複数のファイルを送信できる
* ファイルを区切るための、「境界文字列」がヘッダーに必要になる
* ボディには、`Content-Disposition`という`Content-Type`のようなものが含まれる
* `x-www-form-urlencoded`との違いとして、項目ごとに追加のメタ情報をタグとして持てる
* form要素に、`enctype="multipart/form-data`属性を追加することで利用できる
</script>

<script layout="code" invert type="text/x-markdown">
### 前節の-dを、-Fに変更した場合

```sh
curl --http1.0 -F title="The Art of Community" -F author="Jono Bacon" http://localhost:18888
```

```http
POST / HTTP/1.0
Host: localhost:18888
Connection: close
Accept: */*
Content-Length: 265
Content-Type: multipart/form-data; boundary=------------------------0fd3f4216c00d645
User-Agent: curl/7.43.0

--------------------------0fd3f4216c00d645
Content-Disposition: form-data; name="title"

The Art of Community
--------------------------0fd3f4216c00d645
Content-Disposition: form-data; name="author"

Jono Bacon
--------------------------0fd3f4216c00d645--
```

</script>

<script layout="code" invert type="text/x-markdown">
### ファイル送信する場合

```sh
curl --http1.0 -F title="The Art of Community" -F author="Jono Bacon" -F attachment-file=@test.txt http://localhost:18888
```

```http
POST / HTTP/1.0
Host: localhost:18888
Connection: close
Accept: */*
Content-Length: 426
Content-Type: multipart/form-data; boundary=------------------------045357e05821d90d
User-Agent: curl/7.43.0

--------------------------045357e05821d90d
Content-Disposition: form-data; name="title"

The Art of Community
--------------------------045357e05821d90d
Content-Disposition: form-data; name="author"

Jono Bacon
--------------------------045357e05821d90d
Content-Disposition: form-data; name="attachment-file"; filename="test.txt"
Content-Type: text/plain

test text

--------------------------045357e05821d90d--
```

</script>

<script layout="code" invert type="text/x-markdown">
### ファイルだけ送信

```sh
curl --http1.0 -F attachment-file=@test.txt http://localhost:18888
```

```http
POST / HTTP/1.0
Host: localhost:18888
Connection: close
Accept: */*
Content-Length: 207
Content-Type: multipart/form-data; boundary=------------------------41ca5f3472ec97a1
User-Agent: curl/7.43.0

--------------------------41ca5f3472ec97a1
Content-Disposition: form-data; name="attachment-file"; filename="test.txt"
Content-Type: text/plain

test text

--------------------------41ca5f3472ec97a1--
```

</script>

<script layout="code" invert type="text/x-markdown">
### ファイルの形式指定

```sh
curl --http1.0 -F "attachment-file=@test.txt;type=text/html" http://localhost:18888
```

```http
POST / HTTP/1.0
Host: localhost:18888
Connection: close
Accept: */*
Content-Length: 206
Content-Type: multipart/form-data; boundary=------------------------e06fd88082609e43
User-Agent: curl/7.43.0

--------------------------e06fd88082609e43
Content-Disposition: form-data; name="attachment-file"; filename="test.txt"
Content-Type: text/html

test text

--------------------------e06fd88082609e43--
```

</script>

<script layout="code" invert type="text/x-markdown">
### ファイル名を指定

```sh
curl --http1.0 -F "attachment-file=@test.txt;filename=sample.txt" http://localhost:18888
```

```http
POST / HTTP/1.0
Host: localhost:18888
Connection: close
Accept: */*
Content-Length: 209
Content-Type: multipart/form-data; boundary=------------------------8cc56c8b57f730d4
User-Agent: curl/7.43.0

--------------------------8cc56c8b57f730d4
Content-Disposition: form-data; name="attachment-file"; filename="sample.txt"
Content-Type: text/plain

test text

--------------------------8cc56c8b57f730d4--
```

</script>

<script layout type="text/x-markdown">
### 2.3 フォームを利用したリダイレクト
</script>

<script layout type="text/x-markdown">
### フォームを利用したリダイレクトのメリット
* GETのQueryStringを使った方法のような、文字数制限がない
* アクセスログに残ってしまう懸念がない
</script>

<script layout type="text/x-markdown">
### 2.4 コンテントネゴシエーション
</script>

<script layout type="text/x-markdown">
### コンテントネゴシエーションとは
* 前提として、サーバーとクライアントは別々に開発・運用されているため、両者の期待している形式や設定が常に一致するとは限らない
* コンテントネゴシエーションは、サーバーとクライアントの通信方法を最適化するための仕組み
* ネゴシエーションには、ヘッダーを利用する
</script>

<script layout type="text/x-markdown">
|リクエストヘッダー |レスポンス |ネゴシエーション対象
|:--|:--|:--
|Accept |Content-Type |MIMEタイプ
|Accept-Language |Content-Language, htmlタグ |表示言語
|Accept-Charset |Content-Type | 文字のキャラクターセット
|Accept-Encoding |Content-Encoding |ボディの圧縮
</script>

<script layout type="text/x-markdown">
### ファイルの種類の決定
* 品質係数(`q`)を使って、ファイルの優先度を指定する
* ・ 数値は、`0` ~ `1`まであり、数値が高い方が優先
* ・ デフォルト値は、`1.0`
* お互いに一致しているものがなければ、`406 Not Acceptable`をサーバーが返す
</script>

<script layout type="text/x-markdown">
### 表示言語の決定
* ファイルの種類の決定とほぼ同じ
* ただし、ヘッダーを使わずにHTML内で指定しているサイトが一般的
* e.g. `<html lang="ja">`
</script>

<script layout type="text/x-markdown">
### キャラクターセットの決定
* ファイルの種類の決定とほぼ同じ
* ただし、モダンブラウザではヘッダーを送信していない
* (おそらく全てのキャラクターセットのエンコーダーを内包しているため、ネゴシエーションの必要がないため)
* HTML内で指定する方法も可能
* (HTMLをローカルに保存して表示する場合もあるため、併用されることが多い)
* e.g. `<meta charset="UTF-8">`
</script>

<script layout type="text/x-markdown">
### 圧縮によるメリット
* 転送速度の向上
* 通信料金や、モバイル端末の電力消費の削減
</script>

<script layout type="text/x-markdown">
### 圧縮方法の決定
* HTTPヘッダーで指定する
* クライアントからサーバーへのアップロード時にも圧縮をできるようにする議論が行われている
* -> 基本は同じ仕組み (同じヘッダーを使用する)
</script>

<script layout="code" invert type="text/x-markdown">
### --compressedの使用例

```sh
curl --http1.0 --compressed http://localhost:18888
```

```http
GET / HTTP/1.0
Host: localhost:18888
Connection: close
Accept: */*
Accept-Encoding: deflate, gzip
User-Agent: curl/7.43.0
```

</script>

<script layout type="text/x-markdown">
### 2.5 クッキー
</script>

<script layout="code" invert type="text/x-markdown">
### クッキー
* セットする場合のレスポンスヘッダー

```http
Set-Cookie: LAST_ACCESS_DATE=Jul/31/2016
Set-Cookie: LAST_ACCESS_TIME=12:04
```

* クッキーの情報を伝えるリクエストヘッダー

```http
Cookie: LAST_ACCESS_DATE=Jul/31/2016
Cookie: LAST_ACCESS_TIME=12:04
```

</script>

<script layout type="text/x-markdown">
### クッキーの問題点
* ・ 永続性の問題
* ・ 容量の問題
* ・ セキュリティの問題
* -> 消えても問題ない情報だけを入れるのに適している
</script>

<script layout="code" invert type="text/x-markdown">
### クッキーに制約を与える
* 前提として、クッキーを本来必要としないサーバーに送るとセキュリティのリスクが高めてしまう
* そこで、送信先の制御やクッキーの寿命を設定する属性が存在する
* 属性はセミコロンで区切って複数指定できる

```http
Set-Cookie: SID=31d4d9631dsga; Path=/; Secure; HttpOnly
Set-Cookie: lang=en-US; Path=/; Domain=example.com
```
</script>

<script layout type="text/x-markdown">
### 2.
</script>

<script layout type="text/x-markdown">
###
*
</script>

<script layout type="text/x-markdown">
### 2.
</script>

<script layout type="text/x-markdown">
###
*
</script>

<script layout type="text/x-markdown">
### 2.
</script>

<script layout type="text/x-markdown">
###
*
</script>

<script layout type="text/x-markdown">
### 2.
</script>

<script layout type="text/x-markdown">
###
*
</script>

<script layout type="text/x-markdown">
### 2.
</script>

<script layout type="text/x-markdown">
###
*
</script>

<script layout type="text/x-markdown">
### 2.
</script>

<script layout type="text/x-markdown">
###
*
</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script src="./dist/talkie.min.js"></script>
<script>Talkie();</script>
</body>
</html>
